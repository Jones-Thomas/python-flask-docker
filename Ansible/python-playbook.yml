---
- hosts: webservers
  tasks:
  - name: Install Docker
    shell: |
      yum install python-pip docker -y
    become: true
  - name: Add the user to the docker group
    command: usermod -a -G docker ec2-user #echo "$(id ec2-user)"
    become: true
  - name: Start Docker service
    service:
      name: docker
      state: started
      enabled: yes
    become: yes
  - name: log into docker hub registry
    become: yes
    command: docker login -u="jonesthomas" -p="Jonesthomas@1"
  #- name: Stop all running container
    #command: docker rm 'docker ps -aq'
    #command: docker container prune
    #become: true
  #- name: Remove the old image
    #command: docker rmi $(docker images -q)
    #become: true
  - name: Ensure a container is running
    command: docker run -d --name python-flask-app -p 5000:5000 jonesthomas/first-node-app:16
  - name: Log out of DockerHub
    command: docker logout
    become: true